<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  integrity="sha512-K5N5tvZl5rE5sZK20evRR0ZwDga8N8RbX9lfwGyx7LJ0JXwEjyoWQZxV0TCjDP/5a7gE5q9YQ3o5XcMEU3kCyw=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
/>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const ctx = document.getElementById('statsChart').getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, '#7C3AED');   // Violet
    gradient.addColorStop(1, '#3B82F6');   // Bleu

    const statsChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
        datasets: [{
          label: 'Completed Tasks',
          data: [3, 7, 4, 5, 6],
          backgroundColor: gradient,
          borderRadius: 10,
          hoverBackgroundColor: '#4F46E5'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            labels: {
              color: '#374151',
              font: {
                family: 'Outfit',
                size: 14,
                weight: 'bold'
              }
            }
          },
          tooltip: {
            backgroundColor: '#1F2937',
            titleColor: '#E5E7EB',
            bodyColor: '#E5E7EB',
            cornerRadius: 6,
            padding: 10
          }
        },
        scales: {
          x: {
            ticks: {
              color: '#4B5563',
              font: {
                family: 'Outfit',
                size: 13
              }
            },
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              color: '#4B5563',
              font: {
                family: 'Outfit',
                size: 13
              }
            },
            grid: {
              color: '#E5E7EB'
            }
          }
        },
        animation: {
          duration: 1000,
          easing: 'easeOutQuart'
        }
      }
    };

    new Chart(ctx, config);
  });

</script>

<div class ="dashboard-page">
  <div class="container font-main">
  <h1 class = "text-center mt-3 font-main">Overview</h1>
    <div class="top-section">
      <div class="statistics-card">
        <div class="statistics-box font-main">
          <h2 class="font-main text-center">Statistics</h2>
          <div class="graph-placeholder">
            <canvas id="statsChart" width="600" height="400" class="font-main"></canvas>
          </div>

          <!-- New button link to advanced statistics page -->
          <%= link_to "ðŸ“Š Advanced Statistics", advanced_statistics_path, class: "btn btn-outline-primary" %>


        </div>
      </div>

      <div class="right-column">
        <div class="task-form dashboard-card font-main">
          <form>
            <h2 class ="text-center mb-3 font-main"> New task </h2>

            <label for="time">Assigned time (min.):</label>
            <input type="number" id="time" name="time" value="25" min="1" required />

            <fieldset class="mt-3 ">
              <legend>Time distribution:</legend>
              <label><input type="radio" name="distribution" value="even" checked /> Evenly</label><br />
              <label><input type="radio" name="distribution" value="incremental" /> Incremental</label><br />
              <label><input type="radio" name="distribution" value="decremental" /> Decremental</label><br />
              <label><input type="radio" name="distribution" value="random" /> Random</label>
            </fieldset>
            <button type="button" class="btn mt-3 btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalCenter">
              Create a New Task
            </button>
          </form>
        </div>
        <div class="recent-tasks dashboard-card overflow-auto" style="max-height: 200px;">
          <h3 class="font-main text-center">Recent Tasks</h3>
          <ul class="task-list">
            <li>Reading</li>
            <li>Writing</li>
            <li>Having a short break</li>
            <li>Cooking</li>
            <li>Have to call my boss to tell him that i want to leave my job</li>
            <li>Feeding my dog</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Multi-Step Modal Form -->
    <%= form_with(model: @task, url: tasks_path, local: true) do |form| %>
      <div class="modal fade" id="exampleModalCenter" tabindex="-1" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">

            <div class="modal-header">
              <h5 class="modal-title">Create a Task</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

              <!-- Slide 1 -->
              <div class="step step-1">
                <h5>Task Name:</h5>
                <%= form.text_field :name, name: 'task[name]', class: "form-control", placeholder: "Enter task name", required: true %>
              </div>

              <!-- Slide 2 -->
              <div class="step step-2 d-none">
                <h5>Number of Sub-Tasks:</h5>
                <%= form.select :subtask_count, options_for_select([1,2,3], 3), {}, { class: "form-select", id: "subtaskCountSelect" } %>
                <%# <select class="form-select" id="subtaskCountSelect" name="subtask_count">
                  <option value="1">1 Sub-task</option>
                  <option value="2">2 Sub-tasks</option>
                  <option value="3" selected>3 Sub-tasks</option>
                </select> %>
              </div>
              <%= form.hidden_field :subtask_count, id: "hiddenSubtaskCount" %>
              <%#= hidden_field_tag :subtask_count, nil, id: "hiddenSubtaskCount" %>

              <!-- Slide 3 -->
              <div class="step step-3 d-none">
                <h5>Sub-task Names:</h5>
                <div id="subtaskInputs">
                  <!-- Sub-task inputs inserted here dynamically -->
                </div>
              </div>

              <!-- Slide 4 -->
              <div class="step step-4 d-none">
                <h5>Starting Time:</h5>
                <div class="mb-3">
                  <label for="date">Date:</label>
                  <input type="date" id="date" class="form-control" required>
                  <%#= form.date_field :start_date, class: "form-control" %>
                </div>
                <div class="mb-3">
                  <label for="time_input">Time (HH:MM):</label>
                  <input type="time" id="time_input" class="form-control" required>
                  <%#= form.time_field :start_time, class: "form-control" %>
                </div>
                <!-- This hidden field will hold the combined datetime -->
                <%= form.hidden_field :time, id: "combinedDatetime", name: "task[time]" %>
              </div>

              <!-- Slide 5 -->
              <div class="step step-5 d-none">
                <h5>Setup Task:</h5>

                <!-- Final summary -->
                <p><strong>Task Summary:</strong></p>
                <%= form.text_area :description, name: 'task[description]', class: "form-control mb-3", rows: 4, placeholder: "Task summary..." %>

                <!-- Hidden field for ISO datetime -->
                <%#= hidden_field_tag :task_time, nil, id: "combinedDatetime" %>

                <%= form.submit "Create Task", class: "btn btn-success" %>
              </div>

            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" id="prevStep" disabled>Back</button>
              <button type="button" class="btn btn-primary" id="nextStep">Next</button>
            </div>

          </div>
        </div>
      </div>
    <% end %>

  </div>
  <footer class="footer-bar">
    <div class="footer-content">
      <a href="https://twitter.com" target="_blank" aria-label="Twitter">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://github.com" target="_blank" aria-label="GitHub">
        <i class="fab fa-github"></i>
      </a>
      <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </div>
  </footer>
</div>
